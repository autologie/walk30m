webpackJsonp([1],[,function(t,e,o){t.exports=window},function(t,e,o){t.exports=jQuery},function(t,e,o){t.exports=_},function(t,e,o){var n,a;n=[o(5),o(6),o(7),o(8),o(9),o(10),o(11)],a=function(t,e,o,n,a,i,r){function l(o){var l=this,s=new Date;l.messages=window.messages,l.$el=o,l.$page=$("html,body"),l.$gotoTopBtn=o.find(".btn[role=goto-top]"),l.$execBtn=o.find(".btn[role=execute]"),l.$cancelBtn=o.find("#control span[role=cancel]"),l.$sendMsgBtn=o.find(".btn[role=send-message]"),l.$goToAboutLink=o.find("a[href=#about]"),l.$message=o.find("#message textarea"),l.$goToAdvancedSettingsLink=o.find("a[href=#advanced-settings]"),l.calcService=new t,l.logger=new e(l.calcService),l.advancedSettingsController=new n(o.find("#advanced-settings")),o.find("#extra").css({top:Math.min($(window).height(),700)+"px"}),l.initEvents(),$.get("https://hotsh9cqva.execute-api.ap-northeast-1.amazonaws.com/develop/client_location").done(function(t){l.mapController=new i(l,o.find("#map-wrapper"),{center:new google.maps.LatLng(t.lat,t.lng)}),l.inputController=new r(l,o.find("#control"),l.mapController),l.progressBar=new a(o.find("#progressbar")),console.log("Application: initialized",new Date-s)}).fail(function(t){window.alert(t)})}return l.prototype.initEvents=function(){var t=this;t.calcService.addListener("complete",_.bind(t.onCompleteCalculation,t)),t.calcService.addListener("progress",_.bind(t.onProgressCalculation,t)),t.calcService.addListener("warn",_.bind(t.onWarning,t)),t.$goToAboutLink.click(_.bind(t.onClickGoToAboutBtn,t)),t.$goToAdvancedSettingsLink.click(_.bind(t.onClickGoToAdvancedSettingsBtn,t)),t.$el.scroll(_.bind(t.onScroll,t)),t.$gotoTopBtn.click(_.bind(t.scrollToTop,t)),t.$sendMsgBtn.click(_.bind(t.onClickSendMsgBtn,t)),t.$execBtn.click(_.bind(t.startCalculation,t)),t.$cancelBtn.click(_.bind(t.viewMap,t)),t.scrollToTop()},l.prototype.viewMap=function(){var t=this;t.inputController.togglePanel(!1),t.mapController.startView(function(){t.inputController.togglePanel(!0)})},l.prototype.onProgressCalculation=function(t,e){var o=this;o.progressBar.update(t)},l.prototype.onWarning=function(t){var e=this;window.confirm(e.getMessage("askIfReload"))&&window.location.reload()},l.prototype.onCompleteCalculation=function(t){var e=this;e.progressBar.update(100)},l.prototype.onScroll=_.throttle(function(){var t=this;t.$el.scrollTop()>0?t.$gotoTopBtn.fadeIn():t.$gotoTopBtn.fadeOut()},100),l.prototype.onClickGoToAdvancedSettingsBtn=function(t){var e=this;t.preventDefault(),e.$page.animate({scrollTop:e.$el.find("#advanced-settings").offset().top+"px"},void 0,"swing")},l.prototype.onClickGoToAboutBtn=function(t){var e=this;t.preventDefault(),e.$page.animate({scrollTop:e.$el.find("#about").offset().top+"px"},void 0,"swing")},l.prototype.onClickSendMsgBtn=function(){var t=this,e=t.$el.find("#message textarea").val();e?(t.$sendMsgBtn.addClass("disabled"),t.sendMessage(e).then(function(){_.delay(function(){t.$sendMsgBtn.removeClass("disabled")},500)})):window.alert(t.getMessage("contact"))},l.prototype.scrollToTop=function(t){var e=this,o=!1;e.$gotoTopBtn.blur(),e.$page.animate({scrollTop:"0px"},void 0,function(){!o&&_.isFunction(t)&&(o=!0,t())})},l.prototype.sendMessage=function(t){var e=this;return $.ajax({type:"POST",url:"/api/messages",contentType:"application/json; charset=utf-8",data:JSON.stringify({message:t,url:window.location.href})}).done(function(){window.alert(e.getMessage("thanks"))}).fail(function(){})},l.prototype.compareGeocoderResultsByDistance=function(t,e){var o=this,n=o.mapController.map.getCenter();return loc1=t.geometry.location,loc2=e.geometry.location,r1Dist=Math.pow(loc1.lat()-n.lat(),2)+Math.pow(loc1.lng()-n.lng(),2),r2Dist=Math.pow(loc2.lat()-n.lat(),2)+Math.pow(loc2.lng()-n.lng(),2),r1Dist>r2Dist?1:-1},l.prototype.startCalculation=function(){var t=this,e=_.defaults(t.inputController.getValues(),t.advancedSettingsController.getValues());t.scrollToTop(function(){e.origin?t.doCalculation(e):e.address?(new google.maps.Geocoder).geocode({address:e.address},function(n,a){var i=n.sort(_.bind(t.compareGeocoderResultsByDistance,t));return a===google.maps.GeocoderStatus.ZERO_RESULTS?void window.alert(t.getMessage("geocoderResultNotFound")):a!==google.maps.GeocoderStatus.OK?void window.alert(a):void t.doCalculation(_.defaults({origin:i[0].geometry.location,address:o.trimeGeocoderAddress(i[0].formatted_address),keyword:e.address},e))}):(window.alert(t.getMessage("originLocationIsRequired")),t.inputController.$location.focus())})},l.prototype.onExitCalculation=function(t){var e=this;e.inputController.togglePanel(!0),e.calcService.stop(),e.progressBar.finalize(),t&&e.$cancelBtn.show()},l.prototype.doCalculation=function(t){var e=this;e.inputController.togglePanel(!1),e.progressBar.update(0),e.calcService.start(_.defaults(t,{anglePerStep:{SPEED:20,BALANCE:10,PRECISION:5}[t.preference]})),e.mapController.startCalculation(e.calcService,_.bind(e.onExitCalculation,e))},l.prototype.startEditMessage=function(t){var e=this;e.$message.val(t),e.$page.animate({scrollTop:e.$el.find("#message").offset().top+"px"},void 0,"swing"),e.$message.focus(),t&&e.$message.attr("rows",10)},l.prototype.getMessage=function(t){var e=this;return e.messages[t]},l}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[o(12),o(7)],a=function(t,e){"use strict";function o(){var t=this;t.directionsService=new google.maps.DirectionsService,t.isRunning=!1}2*Math.PI;return o.prototype=new google.maps.MVCObject,o.prototype.calcRoute=function(t,e,o){var n,a,i=this,r=i.currentTask;r&&(n=r.config,a=_.pick(n,"origin","avoidFerries","avoidTolls","avoidHighways"),google.maps.event.trigger(i,"request",t),console.log("CalculationService: do directions request",a.origin.toString(),t.toString()),i.directionsService.route(_.defaults({destination:t,travelMode:google.maps.TravelMode[n.mode]},a),function(n,a){a!==google.maps.DirectionsStatus.OVER_QUERY_LIMIT?e(n,a):3>o?_.delay(function(){i.calcRoute(t,e,++o)},2e3*o):(google.maps.event.trigger(i,"warn","FREQUENT_OVER_QUERY_LIMIT"),i.calcRoute(t,e,0))}))},o.prototype.calcNext=function(t,e){function o(a,i){n.isPausing?_.delay(function(){o(a,i)},100):n.dispatch(a,i,{destination:t,isNarrowing:e})}var n=this;n.calcRoute(t,function(t,e){n.isRunning&&o(t,e)},0)},o.prototype.stopMonitorVelocity=function(t){t.timeout&&(window.clearInterval(t.timeout),delete t.timeout)},o.prototype.startMonitorVelocity=function(t,e,o){var n=this;return t.timeout?void console.log("CalculationService: already monitoring",t):(t.timeConsumed=0,void _.delay(function(){t.timeout=window.setInterval(function(){if(!n.isRunning)return void n.stopMonitorVelocity(t);var e=t.getVelocity();console.log("CalculationService: current velocity: ",e),1>e&&google.maps.event.trigger(n,"warn","CALCULATION_IS_GETTING_SLOWER")},o)},e))},o.prototype.start=function(o){var n=this,a=new t(o),i=o.origin;return a.addListener("progress",function(t,e,o){google.maps.event.trigger(n,"progress",t,e,o)}),n.startMonitorVelocity(a,5e3,1e3),n.currentTask=a,n.isPausing=!1,n.isRunning=!0,n.calcNext(new google.maps.LatLng(i.lat(),i.lng()+e.meterToLng(100,i.lat()))),google.maps.event.trigger(n,"start",a),a},o.prototype.walkToFillSecondsAlong=function(t,o){function n(t,o){var n=0,a=[],i=_.reduce(t.lat_lngs,function(t,o,n,a){return n===a.length-1?t:t+e.distance(o,a[n+1])},0)*o;return _.each(t.lat_lngs,function(t,o,r){return 0===o||(n+=e.distance(t,r[o-1]))<=i?void a.push(t):!1}),a}return _.reduce(o,function(e,o){var a;return e&&e.end_flag?e:(a=(e?e.accum:0)+o.duration.value,a>t&&(o.lat_lngs=n(o,1-(a-t)/o.duration.value)),o.accum=a,o.end_flag=a>t,o.concat_path=(e&&e.concat_path||[]).concat(o.lat_lngs),o)},null)},o.prototype.stop=function(){var t=this;t.isRunning=!1,t.stopMonitorVelocity(t.currentTask),delete t.currentTask},o.prototype.pause=function(){this.isPausing=!0},o.prototype.resume=function(){this.isPausing=!1},o.prototype.willBeCompletedWith=function(t){var e=this;return e.currentTask.isComplete(e.currentTask.getGoals().concat(t))},o.prototype.getAdvancedOne=function(t,o,n){var a=t.config.origin;return e.calcAngle(a,o)<=e.calcAngle(a,n)?n:o},o.prototype.dispatch=function(t,o,n){var a,i,r,l,s=this,c=n.destination,p=s.currentTask,d=p.config.time,u=p.config.origin,g=p.config.anglePerStep;o===google.maps.DirectionsStatus.ZERO_RESULTS?(l=e.divide(u,c,.8),s.calcNext(l,!0)):o!==google.maps.DirectionsStatus.OK?google.maps.event.trigger(s,"error",o):(a=t.routes[0].legs[0],a.duration.value>1.2*d?(l=e.divide(u,c,.8),s.calcNext(l,!0)):!n.isNarrowing&&a.duration.value<d?(l=e.divide(u,c,Math.max(1.1,d/a.duration.value)),s.getAdvancedOne(p,c,l)===c&&(l=e.rotate(u,l,g)),s.calcNext(l)):(r=s.walkToFillSecondsAlong(d,a.steps))?(i=r.lat_lngs[r.lat_lngs.length-1],p.hasVisited(i)?(l=e.divide(u,e.rotate(u,c,3),.8),s.calcNext(l,!0)):s.willBeCompletedWith(i)?(s.isRunning=!1,google.maps.event.trigger(s,"complete",p.vertices,p)):(p.vertices.push({endLocation:i,step:r,directionResult:t}),l=e.rotate(u,s.getAdvancedOne(p,i,c),g),s.calcNext(l))):google.maps.event.trigger(s,"error"))},o}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[],a=function(){function t(t){var e=this;e.calcService=t,e.executions={},t.addListener("start",_.bind(e.onStart,e)),t.addListener("complete",_.bind(e.onComplete,e))}var e="https://hotsh9cqva.execute-api.ap-northeast-1.amazonaws.com/develop/execution_log/";return t.prototype.onComplete=function(t,o){var n=this,a=o.taskId;$.ajax({url:e+a,type:"PUT",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(_.defaults({complete_datetime:(new Date).toISOString(),extra_info:_.map(_.collect(t.getArray(),"endLocation"),function(t){return{lat:t.lat(),lng:t.lng()}})},n.executions[a]))})},t.prototype.collectClientInfo=function(){var t=$(window);return{url:window.location.href,viewport:[t.width(),t.height()]}},t.prototype.onStart=function(t){var o=this,n=t.config,a=n.origin,i=_.defaults({start_datetime:(new Date).toISOString(),origin_address:t.address,origin_latitude:a.lat(),origin_longitude:a.lng(),travel_mode:t.mode,avoid_ferries:n.avoidFerries?1:0,avoid_tolls:n.avoidTolls?1:0,avoid_highways:n.avoidHighways?1:0,travel_time_sec:t.time,query:n.keyword},o.collectClientInfo());$.ajax({url:e,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).done(function(e){o.executions[e.uuid]=_.defaults({uuid:e.uuid},i),t.taskId=e.uuid})},t}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[],a=function(){"use strict";var t={};return t.trimGeocoderAddress=function(t){return t.replace(/^[^〒]*〒[\d\-\s]+/,"")},t.spline=function(t){var e=_.map(t.concat(t[0]),function(t){return[t.lat(),t.lng()]}),o=_.range(0,t.length),n=_.range(0,t.length,.1);return _.map(numeric.spline(o,e).at(n),function(t){return new google.maps.LatLng(t[0],t[1])})},t.lngToMeter=function(t,e){var o=4e4;return 1e3*o*Math.cos(2*Math.PI*e/360)*t/360},t.meterToLng=function(t,e){var o=4e4;return 360*t/(1e3*o*Math.cos(2*Math.PI*e/360))},t.distance=function(t,e){var o=Math.cos(2*Math.PI*t.lat()/360);return Math.sqrt(Math.pow(t.lat()-e.lat(),2)+Math.pow((t.lng()-e.lng())*o,2))},t.divide=function(t,e,o){return new google.maps.LatLng(t.lat()+(e.lat()-t.lat())*o,t.lng()+(e.lng()-t.lng())*o)},t.getInclusionBounds=function(t){var e=1e-5;return _.reduce(t,function(t,o){return null===t?new google.maps.LatLngBounds(o,new google.maps.LatLng(o.lat()+e,o.lng()+e)):t.extend(o)},null)},t.getGravityCenter=function(t){var e=t.length;return new google.maps.LatLng(_.reduce(t,function(t,e){return t+e.lat()},0)/e,_.reduce(t,function(t,e){return t+e.lng()},0)/e)},t.isContained=function(t,e){var o=_.map(e,function(t,o){return[t,e[(o+1)%e.length]]}),n=_.filter(o,function(e){var o=(e[0].lng()-t.lng())/(e[0].lng()-e[1].lng()),n=o*e[1].lat()+(1-o)*e[0].lat();return n>=t.lat()&&(e[0].lng()-t.lng())*(e[1].lng()-t.lng())<=0});return n.length%2===1},t.calcAngle=function(t,e){var o=Math.cos(2*Math.PI*t.lat()/360),n=Math.atan((e.lat()-t.lat())/((e.lng()-t.lng())*o));return e.lat()-t.lat()>0&&0>n&&(n+=Math.PI),e.lat()-t.lat()<0&&e.lng()-t.lng()<0&&(n+=Math.PI),e.lat()-t.lat()<0&&e.lng()-t.lng()>=0&&(n+=2*Math.PI),n},t.rotate=function(e,o,n){var a=t.distance(e,o),i=Math.cos(2*Math.PI*e.lat()/360),r=t.calcAngle(e,o)+2*n*Math.PI/360;return new google.maps.LatLng(e.lat()+a*Math.sin(r),e.lng()+a*Math.cos(r)/i)},t}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[],a=function(){function t(t){var e=this;e.$el=t,e.$prefs=t.find("input[name=preference]"),e.$optTolls=t.find("#option_tolls"),e.$optHighways=t.find("#option_highways"),e.$optFerries=t.find("#option_ferries"),e.$initializeBtn=t.find(".btn[role=initialize]"),e.defaultSettings={preference:e.$prefs.filter(":checked").val(),tolls:e.$optTolls.is(":checked"),highways:e.$optHighways.is(":checked"),ferries:e.$optFerries.is(":checked")},e.$initializeBtn.click(_.bind(e.initialize,e))}return t.prototype.initialize=function(){var t=this,e={$optTolls:t.defaultSettings.tolls,$optHighways:t.defaultSettings.highways,$optFerries:t.defaultSettings.ferries};t.$prefs.removeProp("checked"),t.$prefs.filter("[value="+t.defaultSettings.preference+"]").prop("checked","checked");for(p in e)e.hasOwnProperty(p)&&(e[p]?t[p].prop("checked","checked"):t[p].removeAttr("checked"))},t.prototype.getValues=function(){var t=this;return{avoidFerries:!t.$optFerries.is(":checked"),avoidHighways:!t.$optHighways.is(":checked"),avoidTolls:!t.$optTolls.is(":checked"),preference:t.$prefs.filter(":checked").val()}},t}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[],a=function(){function t(t){this.$el=t,t.append('<div class="progress"><div class="inner"></div></div>')}return t.prototype.finalize=_.debounce(function(){var t=this;t.$el.fadeOut(void 0,function(){t.$el.find(".progress").css({width:0})})},1e3),t.prototype.update=_.throttle(function(t){var e=this.$el,o=this;e.is(":visible")?e.find(".progress").animate({width:t+"%"},1e3,function(){100===t&&o.finalize()}):e.fadeIn(void 0,function(){o.update(t)})},1e3),t}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[o(7),o(13),o(14),o(15)],a=function(t,e,o,n){function a(t,a,i){var r=this;r.$el=a,r.application=t,r.$centerMarker=a.find(".center-marker"),r.$message=a.find(".message"),r.$determineBtn=a.find(".btn[role=determine-location]"),r.$retryBtn=a.find(".btn[role=retry]"),r.$cancelBtn=a.find(".btn[role=cancel]"),r.footprint=new e,r.map=r.initMap(i),r.objectManager=new o(r.map),r.resultVisualizer=new n(t,r.map,r.objectManager)}return a.prototype.initMap=function(t){return new google.maps.Map(this.$el.find("#map-canvas").get(0),_.defaults(t||{},{center:new google.maps.LatLng(36,140),zoom:13,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}}))},a.prototype.hideMessage=function(t){this.$message.fadeOut()},a.prototype.showMessage=function(t){this.$message.text(t).fadeIn()},a.prototype.getMap=function(){return this.map},a.prototype.startCalculation=function(t,e){function o(){var a=!t.isRunning;a||window.confirm(n.application.getMessage("askIfAbort"))?(n.objectManager.clearObject("inProgress"),n.$retryBtn.hide(),n.hideMessage(),n.footprint.setMap(null),r.forEach(function(t){google.maps.event.removeListener(t)}),e(a)):n.$retryBtn.off().one("click",o)}var n=this,a=_.template(n.application.getMessage("searching")),i=t.currentTask.config,r=[];n.resultVisualizer.clearResultDetail(),n.showMessage(a(_.defaults({min:i.time/60,travelModeExpr:n.application.getMessage("travelModes")[i.mode]},i))),n.$retryBtn.show(),n.$retryBtn.off().one("click",o),n.footprint.setOptions({position:i.origin}),n.footprint.setMap(n.map),r.push(t.addListener("progress",_.once(_.bind(n.onInitialProgress,n,t)))),r.push(t.addListener("progress",_.bind(n.onProgress,n,t))),r.push(t.addListener("complete",_.bind(n.onComplete,n,t))),n.map.panTo(i.origin)},a.prototype.onComplete=function(t,e,o){var n=this;n.objectManager.clearObject("inProgress"),n.resultVisualizer.addResult({taskId:o.taskId,options:o.config,vertices:e.getArray()}),n.footprint.stop(),n.showMessage(n.application.getMessage("completed")),_.delay(function(){n.hideMessage(),n.footprint.setMap(null)},2e3)},a.prototype.onProgress=function(t,e,o,n){var a=this;a.footprint.setAngle(90-360*e/100),a.drawArea(n)},a.prototype.onInitialProgress=function(t,e,o,n){var a,i,r=this,l=t.currentTask.config.origin;a=Math.abs(l.lat()-o.endLocation.lat()),i=Math.abs(l.lng()-o.endLocation.lng()),r.map.fitBounds({north:l.lat()+a,south:l.lat()-a,east:l.lng()+i,west:l.lng()-i}),r.map.setZoom(r.map.getZoom()-1)},a.prototype.drawArea=function(e){var o=this,n=t.spline(e.concat(e.slice(0).splice(0,Math.round(e.length/2))));o.objectManager.showObject(new google.maps.Polygon({path:n.splice(0,Math.round(2*n.length/3)-2),strokeColor:"#080",fillColor:"#080",clickable:!1,strokeOpacity:.7,fillOpacity:.3,zIndex:100}),null,"inProgress")},a.prototype.startView=function(t){var e=this;e.$retryBtn.show(),e.$retryBtn.off().one("click",function(){e.$retryBtn.hide(),t()})},a.prototype.specifyLocation=function(t){function e(){a.hideMessage()}function o(o){a.$centerMarker.hide(),a.$determineBtn.hide(),a.$cancelBtn.hide(),google.maps.event.removeListener(n),e(),t(o)}var n,a=this;a.$centerMarker.show(),a.$determineBtn.show(),a.$cancelBtn.show(),a.showMessage(a.application.getMessage("dragMapToSpecifyLocation")),n=google.maps.event.addListenerOnce(a.map,"dragstart",e),a.$cancelBtn.off().one("click",function(){o()}),a.$determineBtn.off().one("click",function(){o(a.map.getCenter())})},a}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[o(7),o(9)],a=function(t,e){function o(){window.scrollTo(0,0)}function n(t,e,o){var n=this,i=_.template('<option value="{{num}}" {{selected}}>{{num}}</option>');n.mapController=o,n.application=t,n.getLocationWatchId=null,n.$el=e,n.$selModeList=e.find(".select"),n.$location=e.find("input[name=location]"),n.$time=e.find("[name=travelTime]"),n.$execBtn=e.find(".btn[role=execute]"),n.$cancelBtn=e.find(".glyphicon[role=cancel]"),n.$time.append(_.map(a,function(t){return i({num:t,selected:30===t?"selected":""})}).join("")),n.defaultPlaceholder=n.$location.attr("placeholder"),window.navigator.geolocation||n.$selModeList.find("[data-selmode="+n.selMode.CURRENT+"]").addClass("disabled"),n.initEvents()}var a=_.range(1,61).concat(_.map(_.range(1,19),function(t){return 60+10*t})).concat(_.map(_.range(1,7),function(t){return 240+60*t}));return n.prototype.initEvents=function(){var t=this;t.$selModeList.find("li[data-selmode]:not(.disabled)").click(function(e){var o=$(e.target),n=o.is("li")?o:o.parents("li");t.onSelModeChoosed(n.attr("data-selmode"))}).keydown(_.bind(t.onKeyDownSelModeListItem,t)).blur(_.bind(t.onBlurSelModeListItem,t)),t.$location.focus(function(){t.toggleSelModeList(!0)}),t.$location.blur(_.bind(t.onBlurSelModeListItem,t)),t.$location.keydown(_.bind(t.onKeydown,t)),t.$location.change(function(){t.$location.removeAttr("data-latitude"),t.$location.removeAttr("data-longitude")}),t.$time.blur(o)},n.prototype.onBlurSelModeListItem=function(){var t=this;_.defer(function(){o(),t.$el.find(":focus").is("li")||t.toggleSelModeList(!1)})},n.prototype.onKeydown=function(t){var e,o,n=this;13===t.keyCode?n.$location.blur():38===t.keyCode||40===t.keyCode?(o=n.$selModeList.find("li"),e=o.filter(":focus"),n.$location.blur(),o.eq(38===t.keyCode?o.length-1:0).focus(),t.preventDefault()):n.updateLocationCombo()},n.prototype.onKeyDownSelModeListItem=function(t){var e,o=this,n=$(t.target),a=n.is("li")?n:n.parents("li");13===t.keyCode?o.onSelModeChoosed(a.attr("data-selmode"),o.extractSelModeListItemData(a)):(38===t.keyCode||40===t.keyCode)&&(e=o.$selModeList.find("li"),e.eq((a.index()+(38===t.keyCode?-1:1))%e.length).focus(),t.preventDefault())},n.prototype.extractSelModeListItemData=function(t){return{position:{lat:+t.attr("data-latitude"),lng:+t.attr("data-longitude")},address:t.text()}},n.prototype.updateLocationCombo=_.debounce(function(){var e=this,o=e.$location.val(),n="li[data-selmode=selmode-geocode]",a=_.template('<li tabindex="-1" data-selmode="selmode-geocode" data-latitude="{{lat}}" data-longitude="{{lng}}">{{address}}</li>');e.$selModeList.find(n).remove(),!o||o.length<2||(new google.maps.Geocoder).geocode({address:o},function(o,i){i===google.maps.GeocoderStatus.OK&&(e.$selModeList.prepend(o.slice(0,3).map(function(e){return a({lat:e.geometry.location.lat(),lng:e.geometry.location.lng(),address:t.trimGeocoderAddress(e.formatted_address)})}).join("")),e.$selModeList.find(n).click(function(t){var o=$(t.target);e.onSelModeChoosed(e.selMode.GEOCODE,e.extractSelModeListItemData(o))}).keydown(_.bind(e.onKeyDownSelModeListItem,e)).blur(_.bind(e.onBlurSelModeListItem,e)))})},200),n.prototype.selMode={TEXT:"selmode-text",MAP:"selmode-map",CURRENT:"selmode-current",GEOCODE:"selmode-geocode"},n.prototype.appendElementToLocationInput=function(t,e){var o=this,n=o.$location;e=_.defaults(e||{},{top:0,left:0,width:0}),t.css({top:e.top+n.outerHeight()+"px",left:e.left+Math.round(n.offset().left-(n.outerWidth()-n.width())/2)+"px",width:e.width+n.outerWidth()+"px"})},n.prototype.toggleSelModeList=function(t){var e=this,o=e.$selModeList.is(":visible"),n=!o&&(t!==!1||t===!0),a=o&&(t===!1||t!==!0),i=new $.Deferred;return n?(e.appendElementToLocationInput(e.$selModeList,{left:-3}),e.$selModeList.fadeIn(void 0,function(){i.resolve()}),_.delay(function(){e.$el.one("click",e.__bgClickHandler)},100)):a&&e.$selModeList.fadeOut(void 0,function(){i.resolve()}),i.promise()},n.prototype.selectLocationOnMap=function(){var t=this;t.togglePanel(!1),t.mapController.specifyLocation(function(e){t.togglePanel(!0),e&&(t.setLatLng(e),t.$execBtn.focus())})},n.prototype.selectLocationByText=function(){var t=this;t.$location.focus()},n.prototype.applyGeoLocationResult=function(){var t=this,e=_.bind(t.application.getMessage,t.application);1===t.lastGeoLocationResult.code?window.alert(e("geolocationForbidden")):2===t.lastGeoLocationResult.code?window.alert(e("geolocationUnavailable")):3===t.lastGeoLocationResult.code?window.alert(e("geolocationFailure")):t.lastGeoLocationResult.coords?(crd=t.lastGeoLocationResult.coords,latLng=new google.maps.LatLng(crd.latitude,crd.longitude),t.setLatLng(latLng),t.mapController.map.panTo(latLng)):window.alert(e("geolocationError"))},n.prototype.selectLocationByGeoLocation=function(){var t,o,n=this,a=!1;n.lastGeoLocationResult?(n.$location.attr("placeholder",n.defaultPlaceholder),n.applyGeoLocationResult(n.lastGeoLocationResult),n.$execBtn.focus()):(n.geoLocationWatchId||(a=!0,o=n.$location.parent().find("div[role=progressbar]"),t=new e(o),n.appendElementToLocationInput(o,{top:8,left:7}),t.update(99.9),n.$location.attr("placeholder",n.application.getMessage("geolocationDetecting")),_.delay(function(){n.geoLocationWatchId=window.navigator.geolocation.watchPosition(function(e){n.lastGeoLocationResult=e,t.finalize()},function(e){n.lastGeoLocationResult=e,t.finalize()},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3})},500)),_.delay(function(){n.selectLocationByGeoLocation()},a?500:100))},n.prototype.setLatLng=function(e){var o=this;(new google.maps.Geocoder).geocode({location:e},function(n,a){var i=n.filter(function(t){return!_.contains(t.types,"route")});return a!==google.maps.GeocoderStatus.OK?void window.alert(a):(0===i.length?addr="不明な住所":addr=t.trimGeocoderAddress(i[0].formatted_address),o.$location.val(addr),o.$location.attr("data-latitude",e.lat()),o.$location.attr("data-longitude",e.lng()),void o.$location.blur())})},n.prototype.onSelModeChoosed=function(t,e){var o=this;o.toggleSelModeList(!1),t===o.selMode.MAP?o.selectLocationOnMap():t===o.selMode.GEOCODE?o.selectLocationByGeocodeResult(e):t===o.selMode.TEXT?o.selectLocationByText():t===o.selMode.CURRENT&&o.selectLocationByGeoLocation()},n.prototype.selectLocationByGeocodeResult=function(t){var e=this;e.$location.val(t.address),e.$location.attr("data-latitude",t.position.lat),e.$location.attr("data-longitude",t.position.lng),e.$execBtn.focus()},n.prototype.togglePanel=function(t){var e=this,o=e.$el.find("#app-header"),n="50px"!==e.$el.css("height"),a=!n&&t!==!1,i=n&&t!==!0;a?(e.isCancellable()&&e.$cancelBtn.show(),o.animate({padding:"3.6em 0 0 120px",zoom:"100%"}),o.find("h1").animate({marginTop:"1em"}),e.$el.animate({height:"100%"})):i&&(e.$cancelBtn.hide(),o.animate({padding:"1em 0 0 60px",zoom:"60%"}),o.find("h1").animate({marginTop:"0"}),e.$el.animate({height:"50px"}))},n.prototype.isCancellable=function(){var t=this,e=!1;return t.mapController.map.data.forEach(function(t){return t.getProperty("isResult")===!0?(e=!0,!1):void 0}),e},n.prototype.getValues=function(){var t=this,e=+t.$location.attr("data-latitude"),o=+t.$location.attr("data-longitude");return{address:t.$location.val(),origin:e&&o?new google.maps.LatLng(e,o):void 0,time:60*+t.$time.val(),mode:t.$el.find("input[name=travelMode]:checked").val()}},n}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[o(7)],a=function(t){"use strict";function e(t){var e=this;e.config=t,e.consumedTime=0,e.vertices=new google.maps.MVCArray,e.vertices.addListener("insert_at",function(t){var o=e.vertices.getAt(t);google.maps.event.trigger(e,"progress",e.getProgress(),o,e.getGoals())})}var o=2*Math.PI;Math.PI/2;return e.prototype=new google.maps.MVCObject,e.prototype.getGoals=function(){return _.collect(this.vertices.getArray(),"endLocation")},e.prototype.getProgress=function(){var t=this;return Math.round(100*t.accumulateAngles(t.getGoals())/o)},e.prototype.getVelocity=function(){var t=this;return 1e3*t.getProgress()/t.consumedTime},e.prototype.isComplete=function(t){var e=this;return e.accumulateAngles(t||e.getGoals())>=o},e.prototype.hasVisited=function(e){var o=this,n=function(o){return t.distance(o.endLocation,e)<5e-4};return _.some(o.vertices.getArray(),n)},e.prototype.accumulateAngles=function(e){var n,a=this,i=_.map(e,function(e){return t.calcAngle(a.config.origin,e)});return _.reduce(i,function(t,e,a,i){return t+(a>0?(n=e-i[a-1])<-1*Math.PI?n+o:n:0)},0)},e}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n;n=function(){function t(t){var e=this;google.maps.Marker.constructor.call(e,t),e.angle=90,e.stepCount=0,e.timer=window.setInterval(function(){e.stepCount++,e.setIcon(e.createIconOption())},500)}return t.prototype=new google.maps.Marker,t.prototype.stop=function(){var t=this;t.setIcon(t.createIconOption(!0)),window.clearInterval(t.timer)},t.prototype.createIconOption=function(t){var e=this;return{path:t?["M","33.25","16.025278207000508","C","32.0125","16.01137519315023","29.875","17.125","28.5","18.5","C","26.944444444444443","20.055555555555557","26","22.133333333333333","26","24","C","26","25.65","26.718232309083987","29.1375","27.59607179796442","31.75","C","28.817051115483906","35.38370354993694","28.934556004964225","37.02877200266145","28.09607179796442","38.75","C","27.49323230908399","39.9875","27","41.9","27","43","C","27","44.1","27.9","45.45","29","46","C","30.1","46.55","31.5625","46.79335988647727","32.25","46.54079974772727","C","32.9375","46.28823960897727","34.244611443600775","44.60073960897727","35.154692096890614","42.79079974772727","C","36.06477275018045","40.98085988647727","37.29976312969924","37.7","37.89911516248792","35.5","C","38.49846719527659","33.3","39.006023382671565","28.8","39.02701780114341","25.5","C","39.05552142071855","21.019668967058752","38.61369715435026","19.063165635728122","37.28259473554611","17.775278207000508","C","36.30216763099575","16.826681220850787","34.4875","16.039181220850786","33.25","16.025278207000508","Z","M","15.25","18.025278207000508","C","14.0125","18.01137519315023","12.029399448381973","19.0125","10.843109885293275","20.25","C","9.06600455055934","22.103820450048765","8.782723188934392","23.29235909990247","9.234286149351865","27","C","9.535722657672789","29.475","10.956323209290815","34.0875","12.39117626405859","37.25","C","13.826029318826365","40.4125","16.0125","43.697443923338966","17.25","44.54987538519771","C","18.4875","45.402306847056444","20.4","45.96020979614915","21.5","45.789659716514834","C","22.773760289505443","45.59216888123285","23.610306095530625","44.57547853664944","23.803773241635348","42.989784331317125","C","23.970848524534787","41.62040294909271","23.408348524534787","39.0375","22.553773241635348","37.25","C","21.64498244521012","35.34909836954499","21.01353030910185","31.40558005856733","21.03259473554611","27.75","C","21.057182515417388","23.035323791686757","20.6272918537451","21.07631897554676","19.28259473554611","19.775278207000508","C","18.302167630995747","18.826681220850787","16.4875","18.039181220850786","15.25","18.025278207000508","Z",""].join(" "):e.stepCount%2===0?["M","6.75","0.9674052644538893","C","5.512499999999999","0.9494781599035285","3.7238751931502287","1.7369781599035283","2.7752782070005075","2.7174052644538893","C","1.537811369197653","3.996395232246864","1.0449905640558672","6.195073224589727","1.0308551414032063","10.5","C","1.0200194414744117","13.8","1.5015328047234089","18.3","2.1008848375120888","20.5","C","2.7002368703007686","22.7","3.9352272498195546","25.980859886477273","4.84530790310939","27.790799747727274","C","5.755388556399225","29.600739608977275","7.0625","31.288239608977275","7.75","31.540799747727274","C","8.4375","31.793359886477273","9.9","31.55","11","31","C","12.1","30.45","13","29.1","13","28","C","13","26.9","12.50676769091601","24.9875","11.90392820203558","23.75","C","11.065443995035771","22.028772002661448","11.182948884516094","20.383703549936946","12.40392820203558","16.75","C","13.281767690916011","14.1375","14","10.65","14","9","C","14","7.133333333333333","13.055555555555555","5.055555555555555","11.5","3.5","C","10.125","2.125","7.987500000000001","0.9853323690042503","6.75","0.9674052644538893","Z","M","22.75","18.967405264453888","C","21.5125","18.949478159903528","19.723875193150228","19.73697815990353","18.775278207000508","20.717405264453888","C","17.523506201306184","22.01118040924059","17.043624674242828","24.213862596654838","17.025278207000508","28.75","C","17.010964011861812","32.289163976901435","16.326076083975728","36.409634732011256","15.44622675836466","38.25","C","14.591651475465222","40.0375","14.029151475465222","42.62040294909271","14.19622675836466","43.989784331317125","C","14.389693904469379","45.57547853664944","15.226239710494553","46.592168881232844","16.5","46.789659716514834","C","17.6","46.960209796149144","19.5125","46.40230684705644","20.75","45.5498753851977","C","21.9875","44.697443923338966","24.173970681173635","41.4125","25.60882373594141","38.25","C","27.043676790709185","35.0875","28.46427734232721","30.475","28.765713850648137","28","C","29.21727681106561","24.29235909990247","28.933995449440662","23.103820450048765","27.156890114706727","21.25","C","25.970600551618027","20.0125","23.9875","18.98533236900425","22.75","18.967405264453888","Z",""].join(" "):["M","23.25","1.025278207000508","C","22.0125","1.0113751931502286","19.875","2.125","18.5","3.5","C","16.944444444444443","5.055555555555555","16","7.133333333333333","16","9","C","16","10.65","16.718232309083987","14.1375","17.59607179796442","16.75","C","18.817051115483906","20.383703549936943","18.934556004964225","22.028772002661448","18.09607179796442","23.75","C","17.49323230908399","24.9875","17","26.9","17","28","C","17","29.1","17.9","30.45","19","31","C","20.1","31.55","21.5625","31.793359886477273","22.25","31.54079974772727","C","22.9375","31.288239608977268","24.244611443600775","29.600739608977268","25.154692096890614","27.79079974772727","C","26.06477275018045","25.980859886477273","27.299763129699233","22.7","27.89911516248791","20.5","C","28.49846719527659","18.3","29.006023382671565","13.8","29.02701780114341","10.5","C","29.05552142071855","6.019668967058752","28.613697154350263","4.063165635728123","27.28259473554611","2.7752782070005075","C","26.302167630995747","1.8266812208507872","24.4875","1.0391812208507871","23.25","1.025278207000508","Z","M","7.25","19.025278207000508","C","6.012499999999999","19.01137519315023","4.029399448381974","20.0125","2.843109885293275","21.25","C","1.066004550559339","23.103820450048765","0.782723188934392","24.29235909990247","1.234286149351865","28","C","1.535722657672788","30.475","2.9563232092908143","35.0875","4.39117626405859","38.25","C","5.826029318826366","41.4125","8.0125","44.697443923338966","9.25","45.54987538519771","C","10.4875","46.402306847056444","12.4","46.96020979614915","13.5","46.789659716514834","C","14.773760289505443","46.59216888123285","15.610306095530625","45.57547853664944","15.803773241635348","43.989784331317125","C","15.970848524534787","42.62040294909271","15.408348524534787","40.0375","14.553773241635348","38.25","C","13.644982445210116","36.34909836954499","13.013530309101847","32.40558005856733","13.032594735546109","28.75","C","13.057182515417391","24.03532379168675","12.6272918537451","22.07631897554676","11.282594735546109","20.775278207000508","C","10.302167630995749","19.826681220850787","8.4875","19.039181220850786","7.25","19.025278207000508","Z",""].join(" "),
fillColor:"#233f5b",fillOpacity:1,strokeWeight:0,rotation:e.angle,scale:1,anchor:new google.maps.Point(15,24)}},t.prototype.setAngle=function(t){this.angle=t},t}.call(e,o,e,t),!(void 0!==n&&(t.exports=n))},function(t,e,o){var n,a;n=[],a=function(){"use strict";function t(t){var e=this;google.maps.MVCArray.constructor.call(e),e.map=t,e.addListener("remove_at",function(t,e){if(e[0].setMap)e[0].setMap(null);else{if(!e.close)throw new Error("cannot destroy item",e);e[0].close()}}),e.addListener("insert_at",function(t){var o=e.getArray()[t],n=o[0];o[1],o[2];n.open?n.open(e.map):n.setMap(e.map)})}return t.prototype=new google.maps.MVCArray,t.prototype.clearObject=function(t){var e=this;t&&e.forEach(function(o,n){return o[2]===t?(e.removeAt(n),!1):void 0})},t.prototype.clearObjects=function(t){var e=this,o=[];e.forEach(function(e,n){!e||void 0!==t&&e[1]!==t||o.push(n)});for(var n=o.length;n>0;--n)e.removeAt(n-1)},t.prototype.findObject=function(t){var e=this;return e.getArray().filter(function(e){return e[2]===t}).pop()},t.prototype.showObject=function(t,e,o){var n=this;return n.clearObject(o),n.push([t,e,o]),t},t}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[o(7),o(16)],a=function(t,e){function o(t,e,o){var n=this,a=e.data.getStyle();n.application=t,n.map=e,n.objectManager=o,n.twitterURITpl=_.template("https://twitter.com/intent/tweet?text={{message}}&url={{url}}&hashtags=walk30m"),n.routeLinkTpl=_.template("https://www.google.co.jp/maps/dir/{{originLat}},{{originLng}}/{{destLat}},{{destLng}}"),n.balloonTpl=_.template(t.getMessage("routeDetailBalloonTpl")),n.summaryBalloonTpl=_.template(t.getMessage("resultSummaryBalloonTpl")),n.map.data.addListener("click",_.bind(n.onClickResult,n)),n.map.data.setStyle(function(t){return t.getProperty("isResult")===!0?{strokeColor:"#4a4",fillColor:"#4a4",strokeOpacity:1,fillOpacity:.3}:_.isObject(a)?a:_.isFunction(a)?a(t):{}})}return o.prototype.createRouteLink=function(t){var e=this,o=t.overview_path;return e.routeLinkTpl({originLat:o[0].lat(),originLng:o[0].lng(),destLat:t.overview_path[o.length-1].lat(),destLng:o[o.length-1].lng()})},o.prototype.createBalloonContent=function(e){var o=this,n=e.routes[0],a=o.balloonTpl({dest:t.trimGeocoderAddress(n.legs[0].end_address),time:n.legs[0].duration.text,url:o.createRouteLink(n),summary:n.summary,copyright:n.copyrights});return a},o.prototype.clearResultDetail=function(){var t=this;t.objectManager.clearObject("routeBalloon"),t.objectManager.clearObjects("route")},o.prototype.showResultDetail=function(t){var e=this,o="route";t.getProperty("vertices").forEach(function(t){function n(o){e.objectManager.clearObject("routeBalloon"),e.objectManager.showObject(new google.maps.InfoWindow({position:o.latLng,content:e.createBalloonContent(t.directionResult),maxWidth:320}),null,"routeBalloon")}var a=t.directionResult.routes[0].overview_path,i=e.objectManager.showObject(new google.maps.Marker({position:a[a.length-1],icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,strokeColor:"#4a4",strokeWeight:3}}),o);e.objectManager.showObject(new google.maps.Polyline({path:a,clickable:!1,strokeColor:"#4a4",strokeWeight:3,strokeOpacity:1}),o);i.addListener("click",n)})},o.prototype.createSummary=function(t){var o=this,n=t.getProperty("options");return o.summaryBalloonTpl(e.createSummary(_.defaults({timeUnitMinExpr:o.application.getMessage("timeUnitMinExpr")},n)))},o.prototype.showSummaryBalloon=function(t){var o=this,n=_.bind(o.application.getMessage,o.application);$balloon=$(o.map.getDiv()).find(".gm-style-iw"),options=t.getProperty("options"),summary=e.createSummary(_.defaults({travelModeExpr:n("travelModes")[options.mode],timeUnitMinExpr:n("timeUnitMinExpr")},options)),o.objectManager.showObject(new google.maps.InfoWindow({position:options.origin,content:o.createSummary(t),maxWidth:320}),null,"summaryBalloon"),$balloon.find("a[role=tweet-result]").click(function(){var a=o.twitterURITpl({url:window.encodeURIComponent(e.createSharedURI(t)),message:window.encodeURIComponent(_.template(n("tweetMessageTpl"))(summary))});window.open(a,"_blank")}),$balloon.find("a[role=report-problem]").click(function(){o.application.startEditMessage(_.template(n("reportMessageTpl"))({id:t.getId(),summary:_.template(n("summaryTpl"))(summary)}))}),$balloon.find("a[role=erase-result]").click(function(){o.map.data.remove(t),o.objectManager.clearObject("summaryBalloon")}),$balloon.find("a[role=show-routes]").click(function(){o.objectManager.clearObject("summaryBalloon"),t.setProperty("detailed",!0),o.showResultDetail(t)})},o.prototype.onClickResult=function(t){var e=this;e.clearResultDetail(),t.feature.getProperty("detailed")&&t.feature.setProperty("detailed",!1),e.showSummaryBalloon(t.feature)},o.prototype.addResult=function(e){var o=this,n=_.collect(e.vertices,"endLocation"),a=n.concat(n.slice(0).splice(0,Math.round(n.length/2))),i=function(t){return[t.lng(),t.lat()]},r=t.spline(a);r=r.slice(0,Math.round(2*r.length/3)-2),o.map.data.addGeoJson({type:"Feature",id:e.taskId,geometry:{type:"Polygon",coordinates:[r.concat([r[0]]).map(i)]},properties:_.defaults({isResult:!0,vertices:e.vertices.slice(0)},e)})},o}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,o){var n,a;n=[],a=function(){"use strict";var t={};return t.createSummary=function(t){return _.defaults({originAddress:t.address,timeExpr:t.time/60+t.timeUnitMinExpr},t)},t.encodeResult=function(t){var e=t.reduce(function(t,e){return[e,t[1].concat([[Math.round(1e6*(e.lng-(null===t[0]?0:t[0].lng))),Math.round(1e6*(e.lat-(null===t[0]?0:t[0].lat)))]])]},[null,[]])[1];return e.map(function(t){return[t[0].toString(36),t[1].toString(36)].join(" ")}).join(",").replace(/,/g," ").replace(/\s/g,"+").replace(/\+\-/g,"-")},t.decodeResult=function(t){var e=t.replace(/\+/g," ").replace(/\-/g," -").split(" ").reduce(function(t,e){return[null===t[0]?e:null,null===t[0]?t[1]:t[1].concat([[t[0],e]])]},[null,[]])[1];return e.reduce(function(t,e){var o=parseInt(e[0],36)/1e6,n=parseInt(e[1],36)/1e6;return[[o,n],t?t[1].concat([{lat:t[0][1]+n,lng:t[0][0]+o}]):[{lat:n,lng:o}]]},null)[1]},t.createSharedURI=function(e){return _.template("https://walk30m.com?path={{path}}")({path:t.encodeResult(_.collect(e.getProperty("vertices"),"endLocation").map(function(t){return{lat:t.lat(),lng:t.lng()}}))})},t}.apply(e,n),!(void 0!==a&&(t.exports=a))}]);
//# sourceMappingURL=1.app.js.map